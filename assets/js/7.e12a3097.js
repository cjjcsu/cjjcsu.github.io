(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{424:function(s,a,n){"use strict";n.r(a);var e=n(15),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"编译spark源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译spark源码"}},[s._v("#")]),s._v(" 编译Spark源码")]),s._v(" "),n("ol",[n("li",[s._v("下载源码")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("git clone https://github.com/apache/spark.git\n#创建新分支\ncd spark\ngit checkout -b v3.0.1-cdh6 v3.0.1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("修改pom.xml")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# git diff pom.xml\n\n--- a/pom.xml\n+++ b/pom.xml\n@@ -259,6 +259,14 @@\n     <maven.build.timestamp.format>yyyy-MM-dd HH:mm:ss z</maven.build.timestamp.format>\n   </properties>\n   <repositories>\n+    <repository>\n+      <id>cloudera</id>\n+      <url>https://repository.cloudera.com/artifactory/cloudera-repos/</url>\n+      <name>Cloudera Repositories</name>\n+      <snapshots>\n+        <enabled>true</enabled>\n+      </snapshots>\n+  </repository>\n     <repository>\n       <id>gcs-maven-central-mirror</id>\n       \x3c!--\n@@ -290,6 +298,11 @@\n     </repository>\n   </repositories>\n   <pluginRepositories>\n+    <pluginRepository>\n+      <id>cloudera</id>\n+      <name>Cloudera Repositories</name>\n+      <url>https://repository.cloudera.com/artifactory/cloudera-repos/</url>\n+  </pluginRepository>\n     <pluginRepository>\n       <id>gcs-maven-central-mirror</id>\n       \x3c!--\n@@ -3009,6 +3022,12 @@\n   </build>\n\n   <profiles>\n+    <profile>\n+      <id>hadoop-3.0</id>\n+      <properties>\n+        <hadoop.version>3.0.0-cdh6.3.2</hadoop.version>\n+      </properties>\n+  </profile>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("编译打包")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./dev/make-distribution.sh --name hadoop-3.0.0-cdh6.3.2  --tgz  -Phadoop-3.0 -Pyarn -Phive-thriftserver -DskipTests\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"与chd6集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#与chd6集成"}},[s._v("#")]),s._v(" 与CHD6集成")]),s._v(" "),n("ol",[n("li",[s._v("将上一步编译好的spark解压，我的目录是/opt/spark-3.0.1")]),s._v(" "),n("li",[s._v("将hdfs、hive、yarn等相关配置文件拷贝到spark conf文件夹下")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp /etc/hive/conf/core-site.xml /etc/hive/conf/hdfs-site.xml /etc/hive/conf/hive-site.xml /etc/hive/conf/mapred-site.xml /etc/hive/conf/yarn-site.xml ./\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("编辑spark-env.sh")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp spark-env.sh.template spark-env.sh\nvim spark-env.sh\n\n# 新增如下内容\nexport HADOOP_CONF_DIR=/etc/hadoop/conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("编辑spark-defaults.xml")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp spark-defaults.conf.template spark-defaults.conf\nvim spark-defaults.conf\n\n# 新增如下内容\nspark.sql.hive.metastore.version=2.1.1\nspark.sql.hive.metastore.jars=/opt/cloudera/parcels/CDH/lib/hive/lib/*\n\nspark.authenticate=false\nspark.driver.log.dfsDir=/user/spark/driverLogs\nspark.driver.log.persistToDfs.enabled=true\nspark.dynamicAllocation.enabled=true\nspark.dynamicAllocation.executorIdleTimeout=60\nspark.dynamicAllocation.minExecutors=0\nspark.dynamicAllocation.schedulerBacklogTimeout=1\nspark.eventLog.enabled=true\nspark.io.encryption.enabled=false\nspark.network.crypto.enabled=false\nspark.serializer=org.apache.spark.serializer.KryoSerializer\nspark.shuffle.service.enabled=true\nspark.shuffle.service.port=7337\nspark.ui.enabled=true\nspark.ui.killEnabled=true\nspark.lineage.log.dir=/opt/var/log/spark/lineage\nspark.lineage.enabled=true\nspark.driver.extraClassPath=/usr/share/java/*\nspark.executor.extraClassPath=/usr/share/java/*\nspark.sql.crossJoin.enabled=true\nspark.driver.extraJavaOptions=-Dfile.encoding=utf-8\nspark.executor.extraJavaOptions=-Dfile.encoding=utf-8\nspark.sql.adaptive.enabled=true\nspark.sql.adaptive.join.enabled=true\nspark.kryoserializer.buffer.max=256m\nspark.master=yarn\nspark.submit.deployMode=client\nspark.eventLog.dir=hdfs://nameservice1/user/spark/applicationHistory\nspark.yarn.historyServer.address=http://bigdata-master3.cai-inc.com:18088\nspark.yarn.config.gatewayPath=/opt/cloudera/parcels\nspark.yarn.historyServer.allowTracking=true\nspark.yarn.appMasterEnv.MKL_NUM_THREADS=1\nspark.executorEnv.MKL_NUM_THREADS=1\nspark.yarn.appMasterEnv.OPENBLAS_NUM_THREADS=1\nspark.executorEnv.OPENBLAS_NUM_THREADS=1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);